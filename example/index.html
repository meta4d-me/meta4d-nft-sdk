<html>
  <head>
    <meta charset="UTF-8" />
    <title>Example</title>
  </head>

  <body>
    <p>Hello</p>
  </body>

  <script src="../dist/m4m-web3-bundle.umd.js"></script>
  <script>
    function mint() {
      window.M4M.mintNFT(
        "0xBda6C92e43331924b69FEdeAcCfd6425a64859d4",
        "ipfs:/testtesttest"
      ).then((res) => {
        console.log(res);
        //   var tokenId = res.tokenId;
        //   window.M4M.getNFT(tokenId).then((res) => {
        //     console.log(res);
        //   });
        //   window.M4M.transfer(
        //     "0xBda6C92e43331924b69FEdeAcCfd6425a64859d4",
        //     tokenId
        //   ).then((res) => {
        //     console.log(res);
        //     window.M4M.getNFT(tokenId).then((res) => {
        //       console.log(res);
        //     });
        //     window.M4M.getNFTList(
        //       "0x6600db8Fe26c096feB98C5a2855401591D644817"
        //     ).then((res) => {
        //       for (var i = 0; i < res.length; ++i) {
        //         var nft = res[i];
        //         console.log(nft);
        //         window.M4M.loadSource(nft.metadata.image).then((res) => {
        //           console.log(res);
        //         });
        //         window.M4M.loadSource(nft.metadata.image, "base64").then(
        //           (res) => {
        //             console.log(res);
        //           }
        //         );
        //         window.M4M.loadSource(nft.metadata.image, "blob").then((res) => {
        //           console.log(res);
        //         });
        //       }
        //     });
        //   });
      });
    }

    function onAccountsChanged(accounts) {
      console.log("onAccountsChanged callback: ", accounts);
    }

    function onChainChanged(chainId) {
      console.log("onChainChanged callback: ", chainId);
      if (chainId === 80001) mint();
    }

    function onDisconnect(error) {
      console.log("onDisconnect callback: ", error);
      window.M4M.disconnect();
    }

    function onError(error) {
      console.log("onError callback: ", error);
      console.log(error);
    }

    function testPrepareComponent() {
      window.M4M.prepareComponent({
        chain_name: "mumbai",
        // code of equipment, should be string of number
        component_id: "50",
        description: "test prepare",
        // full name of component
        name: "Blink Blade",
        // abbrevation of name
        symbol: "BB",
        // ipfs hash
        uri: "ipfs://test.bb",
        // attributes that compliant Opense
        attrs: [
          {
            trait_type: "position",
            value: "head",
          },
        ],
      }).then((res) => {
        console.log(res);
      });
    }

    function testBindMetadata() {
      window.M4M.bindMetadata({
        chain_name: "mumbai",
        m4m_token_id: "123123123",
        description: "test",
        name: "testNFT",
        uri: "ipfs://test.nft",
      }).then((res) => {
        console.log(res);
      });
    }

    // get initialization params
    // axios.get('https://web3api.meta4d.me/api/v1/m4m-nft/initialization?original_addr=0x1a8a1dfd9063eae42a2b8339966fbea388430ca4&&original_token_id=3&&chain_name=mumbai')

    function testApproveSimpleNFTForAll() {
      window.M4M.approveForAll(
        "erc721",
        "0x1a8a1dfd9063eae42a2b8339966fbea388430ca4",
        "0xc9d7d33f679000d7621ea381569259eb599ab1c4"
      ).then((approveRes) => {
        console.log("approve res: ", approveRes);
      });
    }
    function testApproveComponentNFTForAll() {
      window.M4M.approveForAll(
        "erc1155",
        "0xb6bb4812a8e075cbad0128e318203553c4ca463d",
        "0xc9d7d33f679000d7621ea381569259eb599ab1c4"
      ).then((approveRes) => {
        console.log("approve res: ", approveRes);
      });
    }
    function testConvert() {
      window.M4M.convertNFT({
        originalNFT: "0x1a8a1dfd9063eae42a2b8339966fbea388430ca4",
        originalTokenId: 3,
        componentIds: [31, 32, 33, 34, 35, 36, 37, 38, 39, 40],
        amounts: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
        sig: "0x4c1ec472960def88fdefe32965db61f6ca766dc84a6621c699ebd48fd44234ed144aa6b4e183ceae9569abbb91239603a7ec401a84a4434f066fe8c0b9d858651b",
      }).then((res) => {
        console.log(res);
      });
    }

    function testSplit() {
      window.M4M.splitM4mNFT({
        m4mNFTId:
          "33899455588519104296850095412402338483695997375173037772559902670018227898376", // get from api initialization
        componentIds: [31, 32, 33, 34, 35],
        amounts: [1, 1, 1, 1, 1],
      }).then((res) => {
        console.log(res);
      });
    }
    function testAssemble() {
      window.M4M.assembleM4mNFT({
        m4mNFTId:
          "33899455588519104296850095412402338483695997375173037772559902670018227898376", // get from api initialization
        componentIds: [31, 32, 33, 34, 35],
        amounts: [1, 1, 1, 1, 1],
      }).then((res) => {
        console.log(res);
      });
    }
    function testRedeem() {
      window.M4M.redeemNFT({
        m4mNFTId:
          "33899455588519104296850095412402338483695997375173037772559902670018227898376", // get from api initialization
        componentIds: [31, 32, 33, 34, 35, 36, 37, 38, 39, 40],
        amounts: [1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
      }).then((res) => {
        console.log(res);
      });
    }

    // call from engine's backend.
    function walletSignAndClaimLoot() {
      // 1. sign your uuid
      window.M4M.walletSign(
        "ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80", // keep your private key in safe
        "your_uuid"
      ).then((res) => {
        console.log("sig: ", res);
        // 2. call m4m backend to get generated sig
        const data = {
          chain_name: "mumbai",
          addr: "your_address",
          uuid: "your_uuid",
          component_id: [1, 2, 3, 4],
          component_nums: [1, 2, 3, 4],
          sig: res, //sig get from above
        };
        axios
          .post("https://web3api.meta4d.me/api/v1/component/claim", data)
          .then((result) => {
            const backendSig = result.data.sig;
            // 3. call sdk's claim loot method
            window.M4M.claimLoot({
              uuid: "your_uuid",
              componentIds: [1, 2, 3, 4],
              amounts: [1, 2, 3, 4],
              sig: backendSig,
            }).then((claimRes) => {
              console.log(claimRes);
            });
          });
      });
    }

    document.onreadystatechange = () => {
      if (document.readyState == "complete") {
        // window.BinanceChain is injected now

        // window.M4M.login(window.M4M.Connector_Types.WalletConnect).then(
        window.M4M.login(window.M4M.Connector_Types.Injected).then((res) => {
          console.log(res);
          window.M4M.connect({
            handleAccountsChanged: onAccountsChanged,
            handleChainChanged: onChainChanged,
            handleDisconnect: onDisconnect,
            handleError: onError,
          });
          window.M4M.getInfo().then((res) => {
            if (res.chainId !== 80001)
              return window.M4M.switchNetwork().then((res) => {});
            // mint();
            // testPrepareComponent();
            // testBindMetadata();
            // testApproveForAll();
            // testConvert();
            // testSplit();
            // testApproveComponentNFTForAll();
            // testAssemble();
            testRedeem();
          });
        });
      }
    };
  </script>
</html>

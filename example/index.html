<html>
  <head>
    <meta charset="UTF-8" />
    <title>Example</title>
  </head>

  <body>
    <p>Hello</p>
  </body>

  <script src="../dist/m4m-web3-bundle.umd.js"></script>
  <script>
    function mint() {
      window.M4M.mintNFT(
        "0x6600db8Fe26c096feB98C5a2855401591D644817",
        "http://www.relation.services/static/home-rubik.545cdbc0.png",
        {
          description: "test",
          name: "TestNft",
          attributes: [],
        }
      ).then((res) => {
        console.log(res);
        var tokenId = res.tokenId;
        window.M4M.getNFT(tokenId).then((res) => {
          console.log(res);
        });
        window.M4M.transfer(
          "0xBda6C92e43331924b69FEdeAcCfd6425a64859d4",
          tokenId
        ).then((res) => {
          console.log(res);
          window.M4M.getNFT(tokenId).then((res) => {
            console.log(res);
          });
          window.M4M.getNFTList(
            "0x6600db8Fe26c096feB98C5a2855401591D644817"
          ).then((res) => {
            for (var i = 0; i < res.length; ++i) {
              var nft = res[i];
              console.log(nft);
              window.M4M.loadSource(nft.metadata.image).then((res) => {
                console.log(res);
              });
              window.M4M.loadSource(nft.metadata.image, "base64").then(
                (res) => {
                  console.log(res);
                }
              );
              window.M4M.loadSource(nft.metadata.image, "blob").then((res) => {
                console.log(res);
              });
            }
          });
        });
      });
    }

    function onAccountsChanged(accounts) {
      console.log("onAccountsChanged callback: ", accounts);
    }

    function onChainChanged(chainId) {
      console.log("onChainChanged callback: ", chainId);
      if (chainId === 80001) mint();
    }

    function onDisconnect(error) {
      console.log("onDisconnect callback: ", error);
      window.M4M.disconnect();
    }

    function onError(error) {
      console.log("onError callback: ", error);
      console.log(error);
    }

    function testPrepareComponent() {
      window.M4M.prepareComponent({
        chain_name: "mumbai",
        // code of equipment, should be string of number
        component_id: "30",
        description: "test prepare",
        // full name of component
        name: "Blink Blade",
        // abbrevation of name
        symbol: "BB",
        // ipfs hash
        uri: "ipfs://test.bb",
        // attributes that compliant Opense
        attrs: { price: 2100 },
      }).then((res) => {
        console.log(res);
      });
    }

    function testBindMetadata() {
      window.M4M.bindMetadata({
        chain_name: "mumbai",
        m4m_token_id: "123123123",
        description: "test",
        name: "testNFT",
        uri: "ipfs://test.nft",
      }).then((res) => {
        console.log(res);
      });
    }

    document.onreadystatechange = () => {
      if (document.readyState == "complete") {
        // window.BinanceChain is injected now

        // window.M4M.login(window.M4M.Connector_Types.WalletConnect).then(
        window.M4M.login(window.M4M.Connector_Types.Injected).then((res) => {
          console.log(res);
          window.M4M.connect({
            handleAccountsChanged: onAccountsChanged,
            handleChainChanged: onChainChanged,
            handleDisconnect: onDisconnect,
            handleError: onError,
          });
          window.M4M.getInfo().then((res) => {
            if (res.chainId !== 80001)
              return window.M4M.switchNetwork().then((res) => {});
            // mint();
            testPrepareComponent();
            // testBindMetadata()
          });
        });
      }
    };
  </script>
</html>
